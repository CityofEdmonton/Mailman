<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mailman</title>

    <!-- Remote stylesheets,  -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://code.getmdl.io/1.2.1/material.teal-red.min.css">

    <!-- Local stylesheets -->
    <!-- build:css inline build/common/css/mdl-article.css -->
    <link rel="stylesheet" type="text/css" href="../css/mdl-article.css" />
    <!-- /build -->

    <!-- build:css inline build/common/css/material-icons.css -->
    <link rel="stylesheet" type="text/css" href="../css/material-icons.css" />
    <!-- /build -->

    <!-- build:css inline build/common/css/rich-text-editor.css -->
    <link rel="stylesheet" type="text/css" href="../css/rich-text-editor.css" />
    <!-- /build -->

    <!-- Remote JavaScript -->
    <script src="https://code.getmdl.io/1.2.1/material.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">
            <div class="btn-group">
                <a class="mdl-button mdl-js-button dropdown-toggle" data-toggle="dropdown" title="Font Size"><i class="material-icons md-24">text_fields</i><i class="material-icons md-18">keyboard_arrow_down</i></a>
                <ul class="dropdown-menu">
                    <li><a data-edit="fontSize 5" class="fs-Five">Huge</a></li>
                    <li><a data-edit="fontSize 3" class="fs-Three">Normal</a></li>
                    <li><a data-edit="fontSize 1" class="fs-One">Small</a></li>
                </ul>
            </div>
            <div class="btn-group">
                <a class="mdl-button mdl-js-button" data-edit="bold" title="Bold (Ctrl+B)"><i class="material-icons md-24">format_bold</i></a>
                <a class="mdl-button mdl-js-button" data-edit="italic" title="Italic (Ctrl+I)"><i class="material-icons md-24">format_italic</i></a>
                <a class="mdl-button mdl-js-button" data-edit="strikethrough" title="Strikethrough"><i class="material-icons md-24">strikethrough_s</i></a>
                <a class="mdl-button mdl-js-button" data-edit="underline" title="Underline (Ctrl+U)"><i class="material-icons md-24">format_underlined</i></a>
            </div>
            <div class="btn-group">
                <a class="mdl-button mdl-js-button" data-edit="insertunorderedlist" title="Bullet list"><i class="material-icons md-24">format_list_bulleted</i></a>
                <a class="mdl-button mdl-js-button" data-edit="insertorderedlist" title="Number list"><i class="material-icons md-24">format_list_numbered</i></a>
                <a class="mdl-button mdl-js-button" data-edit="outdent" title="Reduce indent (Shift+Tab)"><i class="material-icons md-24">format_indent_decrease</i></a>
                <a class="mdl-button mdl-js-button" data-edit="indent" title="Indent (Tab)"><i class="material-icons md-24">format_indent_increase</i></a>
            </div>
            <div class="btn-group">
                <a class="mdl-button mdl-js-button" data-edit="justifyleft" title="Align Left (Ctrl+L)"><i class="material-icons md-24">format_align_left</i></a>
                <a class="mdl-button mdl-js-button" data-edit="justifycenter" title="Center (Ctrl+E)"><i class="material-icons md-24">format_align_center</i></a>
                <a class="mdl-button mdl-js-button" data-edit="justifyright" title="Align Right (Ctrl+R)"><i class="material-icons md-24">format_align_right</i></a>
                <a class="mdl-button mdl-js-button" data-edit="justifyfull" title="Justify (Ctrl+J)"><i class="material-icons md-24">format_align_justify</i></a>
            </div>
            <div class="btn-group">
                <a class="mdl-button mdl-js-button mdl-button--icon" data-toggle="dropdown" title="Hyperlink"><i class="material-icons md-24">insert_link</i></a>
                <div class="dropdown-menu input-append">
                    <input placeholder="URL" type="text" data-edit="createLink" />
                    <button class="btn" type="button">Insert</button>
                </div>
            </div>
            <div class="btn-group">
                <a id="picBtn" class="mdl-button mdl-js-button dropdown-toggle" title="Insert picture (or just drag & drop)" onclick="$('#pictureBtn').click();"><i class="material-icons md-24">insert_photo</i></a>

                <input id="pictureBtn" class="imgUpload" type="file" data-edit="insertImage" data-role="magic-overlay" />
            </div>
            <div class="btn-group">
                <a class="mdl-button mdl-js-button" data-edit="undo" title="Undo (Ctrl+Z)"><i class="material-icons md-24">undo</i></a>
                <a class="mdl-button mdl-js-button" data-edit="redo" title="Redo (Ctrl+Y)"><i class="material-icons md-24">redo</i></a>
            </div>
        </div>
        <div id="editor" class="lead" data-placeholder="Build your email template."></div>
        <div id="editorPreview"></div>
        <p style="text-align: center;">
            <a class="btn btn-large  jumbo" href="#!" onClick="$('#editorPreview').html($('#editor').html());">Submit</a>
        </p>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.js"></script>

    <script>
        /*jslint browser: true*/
        /*jslint jquery: true*/

        /*
         * jQuery Hotkeys Plugin
         * Copyright 2010, John Resig
         * Dual licensed under the MIT or GPL Version 2 licenses.
         *
         * Based upon the plugin by Tzury Bar Yochay:
         * https://github.com/tzuryby/jquery.hotkeys
         *
         * Original idea by:
         * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/
         */

        /*
         * One small change is: now keys are passed by object { keys: '...' }
         * Might be useful, when you want to pass some other data to your handler
         */

        (function(jQuery) {

            jQuery.hotkeys = {
                version: "0.2.0",

                specialKeys: {
                    8: "backspace",
                    9: "tab",
                    10: "return",
                    13: "return",
                    16: "shift",
                    17: "ctrl",
                    18: "alt",
                    19: "pause",
                    20: "capslock",
                    27: "esc",
                    32: "space",
                    33: "pageup",
                    34: "pagedown",
                    35: "end",
                    36: "home",
                    37: "left",
                    38: "up",
                    39: "right",
                    40: "down",
                    45: "insert",
                    46: "del",
                    59: ";",
                    61: "=",
                    96: "0",
                    97: "1",
                    98: "2",
                    99: "3",
                    100: "4",
                    101: "5",
                    102: "6",
                    103: "7",
                    104: "8",
                    105: "9",
                    106: "*",
                    107: "+",
                    109: "-",
                    110: ".",
                    111: "/",
                    112: "f1",
                    113: "f2",
                    114: "f3",
                    115: "f4",
                    116: "f5",
                    117: "f6",
                    118: "f7",
                    119: "f8",
                    120: "f9",
                    121: "f10",
                    122: "f11",
                    123: "f12",
                    144: "numlock",
                    145: "scroll",
                    173: "-",
                    186: ";",
                    187: "=",
                    188: ",",
                    189: "-",
                    190: ".",
                    191: "/",
                    192: "`",
                    219: "[",
                    220: "\\",
                    221: "]",
                    222: "'"
                },

                shiftNums: {
                    "`": "~",
                    "1": "!",
                    "2": "@",
                    "3": "#",
                    "4": "$",
                    "5": "%",
                    "6": "^",
                    "7": "&",
                    "8": "*",
                    "9": "(",
                    "0": ")",
                    "-": "_",
                    "=": "+",
                    ";": ": ",
                    "'": "\"",
                    ",": "<",
                    ".": ">",
                    "/": "?",
                    "\\": "|"
                },

                // excludes: button, checkbox, file, hidden, image, password, radio, reset, search, submit, url
                textAcceptingInputTypes: [
                    "text", "password", "number", "email", "url", "range", "date", "month", "week", "time", "datetime",
                    "datetime-local", "search", "color", "tel"
                ],

                // default input types not to bind to unless bound directly
                textInputTypes: /textarea|input|select/i,

                options: {
                    filterInputAcceptingElements: true,
                    filterTextInputs: true,
                    filterContentEditable: true
                }
            };

            function keyHandler(handleObj) {
                if (typeof handleObj.data === "string") {
                    handleObj.data = {
                        keys: handleObj.data
                    };
                }

                // Only care when a possible input has been specified
                if (!handleObj.data || !handleObj.data.keys || typeof handleObj.data.keys !== "string") {
                    return;
                }

                var origHandler = handleObj.handler,
                    keys = handleObj.data.keys.toLowerCase().split(" ");

                handleObj.handler = function(event) {
                    //      Don't fire in text-accepting inputs that we didn't directly bind to
                    if (this !== event.target &&
                        (jQuery.hotkeys.options.filterInputAcceptingElements &&
                            jQuery.hotkeys.textInputTypes.test(event.target.nodeName) ||
                            (jQuery.hotkeys.options.filterContentEditable && jQuery(event.target).attr('contenteditable')) ||
                            (jQuery.hotkeys.options.filterTextInputs &&
                                jQuery.inArray(event.target.type, jQuery.hotkeys.textAcceptingInputTypes) > -1))) {
                        return;
                    }

                    var special = event.type !== "keypress" && jQuery.hotkeys.specialKeys[event.which],
                        character = String.fromCharCode(event.which).toLowerCase(),
                        modif = "",
                        possible = {};

                    jQuery.each(["alt", "ctrl", "shift"], function(index, specialKey) {

                        if (event[specialKey + 'Key'] && special !== specialKey) {
                            modif += specialKey + '+';
                        }
                    });

                    // metaKey is triggered off ctrlKey erronously
                    if (event.metaKey && !event.ctrlKey && special !== "meta") {
                        modif += "meta+";
                    }

                    if (event.metaKey && special !== "meta" && modif.indexOf("alt+ctrl+shift+") > -1) {
                        modif = modif.replace("alt+ctrl+shift+", "hyper+");
                    }

                    if (special) {
                        possible[modif + special] = true;
                    } else {
                        possible[modif + character] = true;
                        possible[modif + jQuery.hotkeys.shiftNums[character]] = true;

                        // "$" can be triggered as "Shift+4" or "Shift+$" or just "$"
                        if (modif === "shift+") {
                            possible[jQuery.hotkeys.shiftNums[character]] = true;
                        }
                    }

                    for (var i = 0, l = keys.length; i < l; i++) {
                        if (possible[keys[i]]) {
                            return origHandler.apply(this, arguments);
                        }
                    }
                };
            }

            jQuery.each(["keydown", "keyup", "keypress"], function() {
                jQuery.event.special[this] = {
                    add: keyHandler
                };
            });

        })(jQuery || this.jQuery || window.jQuery);
    </script>

    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>


    <!-- bootstrap-wysiwyg.js -->
    <script>
        /* @fileoverview
         * Provides full Bootstrap based, multi-instance WYSIWYG editor.
         *
         * "Name"    = 'bootstrap-wysiwyg'
         * "Author"  = 'Various, see LICENSE'
         * "Version" = '1.0.4'
         * "About"   = 'A tiny Bootstrap and jQuery based WYSIWYG rich text editor based on the browser function execCommand.'
         */

        (function($) {
            'use strict';

            var readFileIntoDataUrl = function(fileInfo) {
                var loader = $.Deferred(),
                    fReader = new FileReader();
                fReader.onload = function(e) {
                    loader.resolve(e.target.result);
                };
                fReader.onerror = loader.reject;
                fReader.onprogress = loader.notify;
                fReader.readAsDataURL(fileInfo);
                return loader.promise();
            };
            $.fn.cleanHtml = function(o) {
                if ($(this).data("wysiwyg-html-mode") === true) {
                    $(this).html($(this).text());
                    $(this).attr('contenteditable', true);
                    $(this).data('wysiwyg-html-mode', false);
                }

                // Strip the images with src="data:image/.." out;
                if (o === true && $(this).parent().is("form")) {
                    var gGal = $(this).html;
                    if ($(gGal).has("img").length) {
                        var gImages = $("img", $(gGal));
                        var gResults = [];
                        var gEditor = $(this).parent();
                        $.each(gImages, function(i, v) {
                            if ($(v).attr('src').match(/^data:image\/.*$/)) {
                                gResults.push(gImages[i]);
                                $(gEditor).prepend("<input value='" + $(v).attr('src') + "' type='hidden' name='postedimage/" + i + "' />");
                                $(v).attr('src', 'postedimage/' + i);
                            }
                        });
                    }
                }
                var html = $(this).html();
                return html && html.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/, '');
            };
            $.fn.wysiwyg = function(userOptions) {
                var editor = this,
                    selectedRange,
                    options,
                    toolbarBtnSelector,
                    updateToolbar = function() {
                        if (options.activeToolbarClass) {
                            $(options.toolbarSelector).find(toolbarBtnSelector).each(function() {
                                var commandArr = $(this).data(options.commandRole).split(' '),
                                    command = commandArr[0];

                                // If the command has an argument and its value matches this button. == used for string/number comparison
                                if (commandArr.length > 1 && document.queryCommandEnabled(command) && document.queryCommandValue(command) === commandArr[1]) {
                                    $(this).addClass(options.activeToolbarClass);
                                    // Else if the command has no arguments and it is active
                                } else if (commandArr.length === 1 && document.queryCommandEnabled(command) && document.queryCommandState(command)) {
                                    $(this).addClass(options.activeToolbarClass);
                                    // Else the command is not active
                                } else {
                                    $(this).removeClass(options.activeToolbarClass);
                                }
                            });
                        }
                    },
                    execCommand = function(commandWithArgs, valueArg) {
                        var commandArr = commandWithArgs.split(' '),
                            command = commandArr.shift(),
                            args = commandArr.join(' ') + (valueArg || '');

                        var parts = commandWithArgs.split('-');

                        if (parts.length === 1) {
                            document.execCommand(command, false, args);
                        } else if (parts[0] === 'format' && parts.length === 2) {
                            document.execCommand('formatBlock', false, parts[1]);
                        }

                        editor.trigger('change');
                        updateToolbar();
                    },
                    bindHotkeys = function(hotKeys) {
                        $.each(hotKeys, function(hotkey, command) {
                            editor.keydown(hotkey, function(e) {
                                if (editor.attr('contenteditable') && editor.is(':visible')) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                    execCommand(command);
                                }
                            }).keyup(hotkey, function(e) {
                                if (editor.attr('contenteditable') && editor.is(':visible')) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                }
                            });
                        });

                        editor.keyup(function() {
                            editor.trigger('change');
                        });
                    },
                    getCurrentRange = function() {
                        var sel, range;
                        if (window.getSelection) {
                            sel = window.getSelection();
                            if (sel.getRangeAt && sel.rangeCount) {
                                range = sel.getRangeAt(0);
                            }
                        } else if (document.selection) {
                            range = document.selection.createRange();
                        }
                        return range;
                    },
                    saveSelection = function() {
                        selectedRange = getCurrentRange();
                    },
                    restoreSelection = function() {
                        var selection;
                        if (window.getSelection || document.createRange) {
                            selection = window.getSelection();
                            if (selectedRange) {
                                try {
                                    selection.removeAllRanges();
                                } catch (ex) {
                                    document.body.createTextRange().select();
                                    document.selection.empty();
                                }
                                selection.addRange(selectedRange);
                            }
                        } else if (document.selection && selectedRange) {
                            selectedRange.select();
                        }
                    },

                    // Adding Toggle HTML based on the work by @jd0000, but cleaned up a little to work in this context.
                    toggleHtmlEdit = function() {
                        if ($(editor).data("wysiwyg-html-mode") !== true) {
                            var oContent = $(editor).html();
                            var editorPre = $("<pre />");
                            $(editorPre).append(document.createTextNode(oContent));
                            $(editorPre).attr('contenteditable', true);
                            $(editor).html(' ');
                            $(editor).append($(editorPre));
                            $(editor).attr('contenteditable', false);
                            $(editor).data("wysiwyg-html-mode", true);
                            $(editorPre).focus();
                        } else {
                            $(editor).html($(editor).text());
                            $(editor).attr('contenteditable', true);
                            $(editor).data('wysiwyg-html-mode', false);
                            $(editor).focus();
                        }
                    },

                    insertFiles = function(files) {
                        editor.focus();
                        $.each(files, function(idx, fileInfo) {
                            if (/^image\//.test(fileInfo.type)) {
                                $.when(readFileIntoDataUrl(fileInfo)).done(function(dataUrl) {
                                    execCommand('insertimage', dataUrl);
                                    editor.trigger('image-inserted');
                                }).fail(function(e) {
                                    options.fileUploadError("file-reader", e);
                                });
                            } else {
                                options.fileUploadError("unsupported-file-type", fileInfo.type);
                            }
                        });
                    },
                    markSelection = function(input, color) {
                        restoreSelection();
                        if (document.queryCommandSupported('hiliteColor')) {
                            document.execCommand('hiliteColor', false, color || 'transparent');
                        }
                        saveSelection();
                        input.data(options.selectionMarker, color);
                    },
                    bindToolbar = function(toolbar, options) {
                        toolbar.find(toolbarBtnSelector).click(function() {
                            restoreSelection();
                            editor.focus();

                            if ($(this).data(options.commandRole) === 'html') {
                                toggleHtmlEdit();
                            } else {
                                execCommand($(this).data(options.commandRole));
                            }
                            saveSelection();
                        });
                        toolbar.find('[data-toggle=dropdown]').click(restoreSelection);

                        toolbar.find('input[type=text][data-' + options.commandRole + ']').on('webkitspeechchange change', function() {
                            var newValue = this.value; /* ugly but prevents fake double-calls due to selection restoration */
                            this.value = '';
                            restoreSelection();
                            if (newValue) {
                                editor.focus();
                                execCommand($(this).data(options.commandRole), newValue);
                            }
                            saveSelection();
                        }).on('focus', function() {
                            var input = $(this);
                            if (!input.data(options.selectionMarker)) {
                                markSelection(input, options.selectionColor);
                                input.focus();
                            }
                        }).on('blur', function() {
                            var input = $(this);
                            if (input.data(options.selectionMarker)) {
                                markSelection(input, false);
                            }
                        });
                        toolbar.find('input[type=file][data-' + options.commandRole + ']').change(function() {
                            restoreSelection();
                            if (this.type === 'file' && this.files && this.files.length > 0) {
                                insertFiles(this.files);
                            }
                            saveSelection();
                            this.value = '';
                        });
                    },
                    initFileDrops = function() {
                        editor.on('dragenter dragover', false)
                            .on('drop', function(e) {
                                var dataTransfer = e.originalEvent.dataTransfer;
                                e.stopPropagation();
                                e.preventDefault();
                                if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {
                                    insertFiles(dataTransfer.files);
                                }
                            });
                    };
                options = $.extend(true, {}, $.fn.wysiwyg.defaults, userOptions);
                toolbarBtnSelector = 'a[data-' + options.commandRole + '],button[data-' + options.commandRole + '],input[type=button][data-' + options.commandRole + ']';
                bindHotkeys(options.hotKeys);

                // Support placeholder attribute on the DIV
                var placeholder = $(this).attr('placeholder');

                if (placeholder !== '') {
                    // Set iniitial state without trashing existing text.
                    if (placeholder !== '' && $(this).text() === '') {
                        $(this).addClass('placeholderText');
                        $(this).html(placeholder);
                    }
                    $(this).bind('focus', function() {
                        if (placeholder !== '' && $(this).text() === placeholder) {
                            $(this).removeClass('placeholderText');
                            $(this).html('');
                        }
                    });
                    $(this).bind('blur', function() {
                        if (placeholder !== '' && $(this).text() === '') {
                            $(this).addClass('placeholderText');
                            $(this).html(placeholder);
                        }
                    });
                }

                if (options.dragAndDropImages) {
                    initFileDrops();
                }
                bindToolbar($(options.toolbarSelector), options);
                editor.attr('contenteditable', true)
                    .on('mouseup keyup mouseout', function() {
                        saveSelection();
                        updateToolbar();
                    });
                $(window).bind('touchend', function(e) {
                    var isInside = (editor.is(e.target) || editor.has(e.target).length > 0),
                        currentRange = getCurrentRange(),
                        clear = currentRange && (currentRange.startContainer === currentRange.endContainer && currentRange.startOffset === currentRange.endOffset);
                    if (!clear || isInside) {
                        saveSelection();
                        updateToolbar();
                    }
                });
                return this;
            };
            $.fn.wysiwyg.defaults = {
                hotKeys: {
                    'Ctrl+b meta+b': 'bold',
                    'Ctrl+i meta+i': 'italic',
                    'Ctrl+u meta+u': 'underline',
                    'Ctrl+z': 'undo',
                    'Ctrl+y meta+y meta+shift+z': 'redo',
                    'Ctrl+l meta+l': 'justifyleft',
                    'Ctrl+r meta+r': 'justifyright',
                    'Ctrl+e meta+e': 'justifycenter',
                    'Ctrl+j meta+j': 'justifyfull',
                    'Shift+tab': 'outdent',
                    'tab': 'indent'
                },
                toolbarSelector: '[data-role=editor-toolbar]',
                commandRole: 'edit',
                activeToolbarClass: 'btn-info',
                selectionMarker: 'edit-focus-marker',
                selectionColor: 'darkgrey',
                dragAndDropImages: true,
                keypressTimeout: 200,
                fileUploadError: function(reason, detail) {
                    console.log("File upload error", reason, detail);
                }
            };
        }(window.jQuery));
    </script>
    <script type='text/javascript'>
        $('#editor').wysiwyg();

        $(".dropdown-menu > input").click(function(e) {
            e.stopPropagation();
        });
    </script>
</body>

</html>
